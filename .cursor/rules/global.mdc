# AI 游戏开发公司 - 全局开发规则

## 项目简介

这是一个 AI 多智能体协作平台，模拟游戏开发公司。用户输入游戏创意后，AI 员工（策划、程序员、美术、测试等）会自由交流、协作开发，最终产出可玩的游戏。

## 代码风格规范

### Python 代码规范
- 使用 `snake_case` 命名变量和函数
- 使用 `PascalCase` 命名类
- 每个文件不超过 150 行（超过则拆分）
- 每个函数必须有 docstring 说明
- 使用 type hints 标注类型
- 使用 async/await 处理异步操作

### 文件头部注释模板
```python
"""
文件: 路径/文件名.py
职责: 简短描述文件的主要职责
依赖: 列出主要依赖的模块
被依赖: 列出哪些模块会使用此文件
关键接口:
  - 函数/类名 -> 简短说明
"""
```

## 架构原则

### 目录结构
- `backend/` - Python 后端，使用 FastAPI
- `backend/engine/` - Agent 引擎核心
- `backend/agents/` - 各个 Agent 的具体实现
- `backend/tools/` - Agent 使用的工具
- `backend/workflows/` - 工作流定义
- `backend/api/` - Web API 和 WebSocket
- `frontend/` - 纯 HTML+CSS+JS 前端
- `projects/` - AI 开发的游戏项目存放处
- `docs/` - 开发文档

### 模块化原则
- 每个文件职责单一，不混杂多个功能
- 相同类型的代码放在同一目录
- 避免循环依赖

### 异步处理
- Agent 工作循环使用 asyncio
- 文件 I/O 使用 aiofiles
- HTTP 请求使用 httpx 的异步接口

## 消息格式规范

所有 Agent 间消息必须遵循以下格式：

```python
{
    "from": "agent_id",       # 发送者 ID
    "to": "agent_id",         # 接收者 ID (可以是 "all" 或 "boss")
    "type": "message_type",   # question/answer/report/request_review
    "content": "消息内容",
    "context": "上下文说明",
    "priority": "normal",     # normal/urgent/blocking
    "timestamp": "ISO8601时间戳"
}
```

## 开发流程

### 分阶段开发
- P0: 环境搭建 ✅
- P1: Agent 引擎核心
- P2: 消息总线 + 多 Agent
- P3: 工具系统
- P4: 游戏开发工作流
- P5: Web 后端 API
- P6: 前端可视化
- P7: 人类介入机制
- P8: 联调测试
- P9: 美术集成
- P10: 优化完善

### 每个阶段结束后
- 编写单元测试验证功能
- 更新相关文档
- 向用户确认无误后再继续

## 重要约束

1. **不要过度设计**：第一版追求可用，不追求完美
2. **文件即真相**：Agent 的上下文不可信，所有共识必须写入文件
3. **防止重复代码**：程序员 Agent 必须先查 api_registry.yaml 再写代码
4. **上下文管理**：严格控制传递给 LLM 的内容大小
5. **错误处理**：所有外部调用（API、文件 I/O）都要有异常处理

## 详细设计文档

完整的项目设计和开发计划请参考：`开发计划.md`
