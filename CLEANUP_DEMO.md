# 🎬 文档清理脚本 - 使用演示

> **目的**: 通过实际示例展示清理脚本的使用过程  
> **创建日期**: 2026-02-11

---

## 📝 场景说明

项目中存在多份重复和过期的文档：
- 根目录和 docs/ 目录都有 `开发计划.md`
- 根目录的 `platform_constitution.md` 严重过期（缺少 P3-P4 记录）
- 其他重复文件

需要清理这些文件，保持文档结构清晰。

---

## 🎯 演示步骤

### 第一步：查看当前文件结构

```powershell
PS D:\Cursor\AI-Company> dir *.md

    目录: D:\Cursor\AI-Company

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        2026-02-11     14:00         125678 开发计划.md         # ⚠️ 旧版本
-a----        2026-02-11     14:00          45321 platform_constitution.md  # 🔴 严重过期
-a----        2026-02-11     14:00          12345 P2前置任务清单.md   # 🟡 重复
-a----        2026-02-11     14:00          34567 P4开发完成总结.md   # 🟡 重复
-a----        2026-02-11     14:00          15234 README.md          # ✅ 最新版本

PS D:\Cursor\AI-Company> dir docs\*.md

    目录: D:\Cursor\AI-Company\docs

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        2026-02-11     14:00         135890 开发计划.md         # ✅ 最新版本
-a----        2026-02-11     14:00          89456 platform_constitution.md  # ✅ 最新版本
-a----        2026-02-11     14:00          12345 P2前置任务清单.md   # ✅ 标准位置
-a----        2026-02-11     14:00          37890 P4_阶段完成报告.md  # ✅ 规范报告
-a----        2026-02-11     14:00           5678 README.md          # ⚠️ 旧版本
```

**问题**：
- ❌ 根目录有 5 个 .md 文件（应该只有 README.md）
- ❌ docs/ 中的 README.md 是旧版本
- ❌ platform_constitution.md 在两个位置，根目录版本严重过期

---

### 第二步：模拟运行（查看清理效果）

```powershell
PS D:\Cursor\AI-Company> python cleanup_duplicate_files.py

🚀 开始文档清理
项目根目录: d:\Cursor\AI-Company
运行模式: 模拟运行（不实际删除）

================================================================================
文件对比说明
================================================================================

1. 开发计划.md (根目录)
   ❌ 删除原因: docs版本更新 (1600行 vs 1529行，多71行)
   ✅ 保留文件: docs/开发计划.md

2. platform_constitution.md (根目录)
   ❌ 删除原因: docs版本最新 (1062行 vs 499行，包含P3-P4完整记录) ⚠️ 严重过期
   ✅ 保留文件: docs/platform_constitution.md

3. P2前置任务清单.md (根目录)
   ❌ 删除原因: 内容相同，统一放在docs目录
   ✅ 保留文件: docs/P2前置任务清单.md

4. P4开发完成总结.md (根目录)
   ❌ 删除原因: docs中已有更规范的报告
   ✅ 保留文件: docs/P4_阶段完成报告.md

5. docs/README.md
   ❌ 删除原因: 根目录版本是最新完整版 (181行 vs 65行)
   ✅ 保留文件: README.md (根目录)

================================================================================

================================================================================
文件分析报告
================================================================================
  📄 开发计划.md                                      125,678 字节
  📄 platform_constitution.md                         45,321 字节
  📄 P2前置任务清单.md                                 12,345 字节
  📄 P4开发完成总结.md                                 34,567 字节
  📄 docs/README.md                                    5,678 字节

总计: 5 个文件, 223,589 字节
================================================================================

⚠️  这是模拟运行，不会实际删除文件
如需实际执行，请运行: python cleanup_duplicate_files.py --execute

================================================================================
✅ 模拟运行完成！如需实际执行，请运行:
   python cleanup_duplicate_files.py --execute
================================================================================
```

**分析结果**：
- ✅ 清理方案合理
- ✅ 保留的文件都是最新版本
- ✅ 删除的都是重复或过期文件

---

### 第三步：实际执行清理

```powershell
PS D:\Cursor\AI-Company> python cleanup_duplicate_files.py --execute

🚀 开始文档清理
项目根目录: d:\Cursor\AI-Company
运行模式: 实际执行

[2026-02-11 14:30:25] [INFO] 创建备份目录: d:\Cursor\AI-Company\backup_before_cleanup

================================================================================
开始备份和删除
================================================================================
[2026-02-11 14:30:25] [INFO] 已备份: 开发计划.md
[2026-02-11 14:30:25] [SUCCESS] 已删除: 开发计划.md
[2026-02-11 14:30:25] [INFO] 已备份: platform_constitution.md
[2026-02-11 14:30:25] [SUCCESS] 已删除: platform_constitution.md
[2026-02-11 14:30:25] [INFO] 已备份: P2前置任务清单.md
[2026-02-11 14:30:25] [SUCCESS] 已删除: P2前置任务清单.md
[2026-02-11 14:30:25] [INFO] 已备份: P4开发完成总结.md
[2026-02-11 14:30:25] [SUCCESS] 已删除: P4开发完成总结.md
[2026-02-11 14:30:25] [INFO] 已备份: docs\README.md
[2026-02-11 14:30:25] [SUCCESS] 已删除: docs\README.md

================================================================================
清理完成总结
================================================================================
✅ 成功清理: 5/5 个文件
📦 备份位置: d:\Cursor\AI-Company\backup_before_cleanup
📝 日志条目: 35 条

[2026-02-11 14:30:25] [INFO] 日志已保存: d:\Cursor\AI-Company\backup_before_cleanup\cleanup_log.txt

================================================================================
📋 后续步骤
================================================================================

1. 验证清理结果:
   - 检查 docs/ 目录是否包含所有必要文档
   - 检查根目录是否只剩 README.md

2. 如需回滚:
   python restore_backup.py backup_before_cleanup

3. 确认无误后:
   可以删除备份目录: d:\Cursor\AI-Company\backup_before_cleanup

================================================================================

================================================================================
✅ 清理完成！
================================================================================
```

**清理结果**：
- ✅ 成功删除 5 个文件
- ✅ 所有文件已备份到 `backup_before_cleanup/`
- ✅ 生成详细日志

---

### 第四步：验证清理结果

```powershell
PS D:\Cursor\AI-Company> dir *.md

    目录: D:\Cursor\AI-Company

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        2026-02-11     14:00          15234 README.md          # ✅ 唯一的 .md 文件

PS D:\Cursor\AI-Company> dir docs\*.md

    目录: D:\Cursor\AI-Company\docs

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        2026-02-11     14:00         135890 开发计划.md         # ✅ 最新版本
-a----        2026-02-11     14:00          89456 platform_constitution.md  # ✅ 最新版本
-a----        2026-02-11     14:00          12345 P2前置任务清单.md   # ✅
-a----        2026-02-11     14:00          37890 P4_阶段完成报告.md  # ✅
-a----        2026-02-11     14:00          25678 文档索引.md        # ✅
```

**验证结果**：
- ✅ 根目录只有 README.md
- ✅ docs/ 目录包含所有开发文档
- ✅ 所有保留的都是最新版本
- ✅ 文档结构清晰规范

---

### 第五步：检查备份

```powershell
PS D:\Cursor\AI-Company> dir backup_before_cleanup

    目录: D:\Cursor\AI-Company\backup_before_cleanup

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        2026-02-11     14:30                docs
-a----        2026-02-11     14:30         125678 开发计划.md
-a----        2026-02-11     14:30          45321 platform_constitution.md
-a----        2026-02-11     14:30          12345 P2前置任务清单.md
-a----        2026-02-11     14:30          34567 P4开发完成总结.md
-a----        2026-02-11     14:30           5234 cleanup_log.txt

PS D:\Cursor\AI-Company> dir backup_before_cleanup\docs

    目录: D:\Cursor\AI-Company\backup_before_cleanup\docs

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        2026-02-11     14:00           5678 README.md
```

**备份验证**：
- ✅ 所有删除的文件都已备份
- ✅ 保持原始目录结构
- ✅ 包含详细清理日志

---

## 🔄 演示：回滚操作（可选）

如果清理后发现问题，可以完全回滚：

### 查看可用备份

```powershell
PS D:\Cursor\AI-Company> python restore_backup.py

用法: python restore_backup.py <backup_dir_name> [--execute]

示例:
  python restore_backup.py backup_before_cleanup
  python restore_backup.py backup_before_cleanup --execute

可用的备份目录:
  - backup_before_cleanup (5 个文件)
```

### 模拟恢复

```powershell
PS D:\Cursor\AI-Company> python restore_backup.py backup_before_cleanup

================================================================================
🔄 开始恢复备份
================================================================================
项目根目录: d:\Cursor\AI-Company
备份目录: d:\Cursor\AI-Company\backup_before_cleanup
运行模式: 模拟运行（不实际恢复）

[2026-02-11 14:35:00] [INFO] 发现备份文件: 5 个

找到 5 个文件待恢复

⚠️  这是模拟运行，不会实际恢复文件
模拟恢复列表:
  📄 开发计划.md → d:\Cursor\AI-Company\开发计划.md
  📄 platform_constitution.md → d:\Cursor\AI-Company\platform_constitution.md
  📄 P2前置任务清单.md → d:\Cursor\AI-Company\P2前置任务清单.md
  📄 P4开发完成总结.md → d:\Cursor\AI-Company\P4开发完成总结.md
  📄 docs\README.md → d:\Cursor\AI-Company\docs\README.md

如需实际执行，请运行:
   python restore_backup.py backup_before_cleanup --execute

================================================================================
✅ 模拟运行完成！
================================================================================
```

### 实际恢复（示例）

```powershell
PS D:\Cursor\AI-Company> python restore_backup.py backup_before_cleanup --execute

================================================================================
🔄 开始恢复备份
================================================================================
运行模式: 实际执行

开始恢复文件
================================================================================
[2026-02-11 14:40:00] [INFO] ✅ 已恢复: 开发计划.md
[2026-02-11 14:40:00] [INFO] ✅ 已恢复: platform_constitution.md
[2026-02-11 14:40:00] [INFO] ✅ 已恢复: P2前置任务清单.md
[2026-02-11 14:40:00] [INFO] ✅ 已恢复: P4开发完成总结.md
[2026-02-11 14:40:00] [INFO] ✅ 已恢复: docs\README.md

恢复完成总结
================================================================================
✅ 成功恢复: 5/5 个文件

🎉 所有文件恢复成功！

================================================================================
✅ 恢复完成！
================================================================================
```

---

## 📊 清理前后对比

### 清理前（混乱）

```
d:\Cursor\AI-Company\
├── README.md                       ✅ 最新
├── 开发计划.md                      ⚠️ 旧版本
├── platform_constitution.md        🔴 严重过期
├── P2前置任务清单.md                🟡 重复
├── P4开发完成总结.md                🟡 重复
│
└── docs\
    ├── README.md                   ⚠️ 旧版本
    ├── 开发计划.md                  ✅ 最新
    ├── platform_constitution.md    ✅ 最新
    ├── P2前置任务清单.md            ✅
    └── P4_阶段完成报告.md           ✅
```

### 清理后（规范）

```
d:\Cursor\AI-Company\
├── README.md                       ✅ 项目入口
│
└── docs\
    ├── 开发计划.md                  ✅ 最新完整版
    ├── platform_constitution.md    ✅ 最新完整版（含P3-P4）
    ├── P2前置任务清单.md            ✅
    ├── P4_阶段完成报告.md           ✅
    └── 文档索引.md                  ✅
```

---

## ✅ 总结

### 清理效果

1. ✅ **文档结构清晰**
   - 根目录只有项目入口 README.md
   - 所有开发文档统一在 docs/ 目录

2. ✅ **避免版本混淆**
   - 删除了过期版本
   - 只保留最新完整版本

3. ✅ **安全可靠**
   - 自动备份所有文件
   - 可以随时完全回滚
   - 详细日志可追溯

### 关键亮点

- 🎯 **智能识别**: 自动识别重复和过期文件
- 🛡️ **安全保障**: 自动备份 + 可回滚
- 📝 **详细日志**: 记录每个操作
- 🎨 **清晰输出**: 彩色标记 + 对比说明

---

**演示版本**: v1.0  
**创建日期**: 2026-02-11  
**作者**: Cursor AI
