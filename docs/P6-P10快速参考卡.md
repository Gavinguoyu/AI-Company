# P6-P10 快速参考卡

> **用途**: 一页纸快速查阅，贴在开发过程中随时参考  
> **打印建议**: A4纸打印，放在显示器旁边

---

## 🚀 标准开发流程（所有阶段通用）

### 开启新阶段（一句话）
```
请阅读 docs/stage_guides/P{X}_指引.md，并开始开发P{X}阶段
```

### 配合执行（用户操作）
1. 当AI提示时运行回归测试: `python tests/run_regression.py`
2. 当AI生成测试后运行: `python test_p{X}.py`
3. 告知AI测试结果（通过/失败）

### 完成标志
- ✅ 代码实现
- ✅ 测试全部通过
- ✅ Constitution已更新
- ✅ 报告已生成（Level 2/3）或跳过（Level 1）

---

## 📊 各阶段快速信息表

| 阶段 | 名称 | 级别 | 复杂度 | 对话轮数 | Token预算 |
|------|------|------|--------|---------|----------|
| **P6** | 前端可视化 | L2 | 高 | 8-12 | ~7万 |
| **P7** | 人类介入 | L1 | 低 | 4-6 | ~3.5万 |
| **P8** | 联调测试 | L3 | 高 | 10-15 | ~10万 |
| **P9** | 美术集成 | L1 | 低 | 3-5 | ~3.5万 |
| **P10** | 优化完善 | L2 | 中 | 6-10 | ~7万 |

**级别说明**:
- L1: 只更新Constitution，不生成报告
- L2: 生成精简报告（150-200行）
- L3: 生成详细报告（400-500行）

---

## 🎯 各阶段核心任务一览

### P6: 前端可视化
**目标**: 浏览器中看到AI公司运行
**核心任务**:
- WebSocket客户端
- 2D办公室视图
- 实时对话面板
- 项目状态面板
- 文件浏览器
- CSS样式

**验收**: 能在浏览器看到Agent活动和消息

---

### P7: 人类介入
**目标**: 用户能做决策
**核心任务**:
- 后端决策等待机制
- 前端决策面板
- WebSocket双向通信

**验收**: 点击决策按钮后Agent继续工作

---

### P8: 联调测试
**目标**: 端到端流程跑通
**核心任务**:
- 完整工作流测试
- Agent通信测试
- 文件系统测试
- 错误恢复测试
- Bug修复

**验收**: 输入游戏创意 → 获得可玩游戏

---

### P9: 美术集成
**目标**: AI生成游戏图片
**核心任务**:
- DALL-E 3集成
- 美术Agent升级
- 图片后处理（可选）

**验收**: 游戏包含AI画的图片

---

### P10: 优化完善
**目标**: 提升质量和性能
**核心任务**:
- 性能优化
- 成本优化（启用缓存）
- 前端体验优化
- 错误处理完善
- 代码质量优化

**验收**: 流畅演示，性能提升可量化

---

## 📁 关键文件位置

### 必读文档
```
docs/stage_guides/P{X}_指引.md     ← 当前阶段任务
docs/platform_constitution.md      ← 已完成架构
docs/优化方案使用指南.md           ← 详细操作手册
```

### 模板文件
```
docs/templates/test_template.md    ← 测试脚本模板
docs/templates/report_template.md  ← 报告生成模板
```

### 工具脚本
```
tests/run_regression.py             ← 回归测试
test_p{X}.py                        ← 阶段测试（AI生成）
```

---

## ⚡ 常用命令

### 测试相关
```bash
# 回归测试
python tests/run_regression.py

# 阶段测试
python test_p6.py  # P6
python test_p7.py  # P7
# ... 依次类推

# 端到端测试（P8）
python test_p8_end_to_end.py
```

### 服务启动
```bash
# 启动后端
python backend/main.py

# 浏览器访问
http://localhost:8000/
```

---

## 🔧 问题处理

### 测试失败
```
1. 复制完整错误信息
2. 发给AI: "测试失败，错误: [错误信息]，请分析修复"
3. AI修复后重新运行测试
```

### Token不足
```
1. 查看当前使用率
2. 如接近100%:
   - 所有剩余阶段改为Level 1
   - 跳过P9（美术集成）
   - P10极简化
```

### 开发卡住
```
1. 查看后端日志
2. 检查Agent状态
3. 重启后端服务
4. 向AI描述卡住的现象
```

---

## 📊 Token使用监控

### 预期使用率

| 完成阶段 | 累计使用率 | 剩余 |
|---------|-----------|------|
| P5完成 | 90% | 10% |
| P6完成 | 93% | 7% |
| P7完成 | 95% | 5% |
| P8完成 | 99% | 1% |
| P9完成 | 100% | 0% |
| P10完成 | 103%* | -3% |

*轻微超限可接受

### 警报阈值
- 🟢 <95%: 正常
- 🟡 95-100%: 注意
- 🔴 >100%: 需要调整

---

## ✅ 检查清单（每阶段结束）

### 代码质量
- [ ] 所有文件<150行
- [ ] 使用async/await
- [ ] 完善的日志记录
- [ ] 符合命名规范

### 测试验证
- [ ] 回归测试通过
- [ ] 阶段测试通过
- [ ] 手动验证通过

### 文档更新
- [ ] Constitution已更新
- [ ] 报告已生成（L2/L3）或确认跳过（L1）
- [ ] 记录了关键接口

### 集成准备
- [ ] 下一阶段的接口已准备
- [ ] 遗留问题已记录
- [ ] 优化建议已记录（如有）

---

## 🆘 紧急联系

### 遇到严重问题
1. 停止当前开发
2. 记录问题现象
3. 查看相关文档:
   - `docs/开发计划.md` (风险清单)
   - `docs/platform_constitution.md` (架构约束)
4. 向AI详细描述问题

### 需要调整方案
1. 评估影响范围
2. 提出调整建议
3. 更新相关文档
4. 继续开发

---

## 💡 最佳实践

### DO (✅)
- ✅ 每次只读2个文档（指引+Constitution）
- ✅ 测试失败立即修复
- ✅ 遵循指引中的技术要点
- ✅ 使用推荐的Skills
- ✅ 保持代码简洁

### DON'T (❌)
- ❌ 不要读完整开发计划（太长）
- ❌ 不要重复测试旧功能
- ❌ 不要生成过长的报告
- ❌ 不要跳过测试环节
- ❌ 不要偏离指引的目标

---

## 📞 快速帮助

### 查看文档
```
@docs/优化方案使用指南.md      ← 详细使用说明
@docs/开发流程总控.md          ← AI开发规范
@docs/stage_guides/P{X}_指引.md ← 阶段任务
```

### 查找问题
```
测试相关    → docs/templates/test_template.md
报告相关    → docs/templates/report_template.md
架构相关    → docs/platform_constitution.md
计划相关    → docs/开发计划.md (仅参考)
```

---

**版本**: v1.0  
**更新**: 2026-02-11  
**打印**: 建议打印此页，开发时参考

---

## 开发口诀（背下来）

```
新阶段开始，一句话搞定
指引加宪法，两个文档读
代码实现好，测试跑一跑
回归先通过，阶段再验证
文档要更新，级别看指引
完成告诉我，下个继续来
```

🚀 **现在就开始P6吧！**

```
请阅读 docs/stage_guides/P6_指引.md，并开始开发P6阶段
```
