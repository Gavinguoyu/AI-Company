# P6-P11 阶段方案调整报告

> **调整日期**: 2026-02-12  
> **调整原因**: 确保核心目标"产出可玩游戏"不丢失，优化开发顺序  
> **调整范围**: P6-P11阶段全面重新规划  
> **状态**: ✅ 已完成

---

## 🎯 调整背景

### 发现的问题

在Ask Mode详细分析后发现：**当前P1-P5无法真正产出游戏！**

**核心问题**:
- P4的工作流引擎只是框架，Agent只"说"要写代码，并没有真正调用`file_tool.write()`
- 程序员Agent只回复"我会写代码"，但`projects/{项目名}/output/`目录是**空的**
- 测试Agent也只是回复"我会测试"，没有真正执行游戏代码
- 用户的核心目标"一句话开发 → 产出可玩游戏"**无法实现**

**风险评估**:
- 如果按原计划继续开发P6-P10，会先做2D办公室可视化
- 用户会看到Agent在办公室里"工作"，但实际上**没有游戏产出**
- 这是一个"空壳"，核心目标丢失

---

## 📋 原计划 vs 调整后

### 原P6-P10规划

| 阶段 | 原内容 | 问题 |
|------|--------|------|
| P6 | 前端可视化（2D办公室） | 核心功能缺失，先做可视化 |
| P7 | 人类介入机制 | 顺序合理 |
| P8 | 端到端联调测试 | **此时才实现真正的游戏生成** |
| P9 | 美术集成 | 顺序合理 |
| P10 | 优化完善 | 顺序合理 |

**主要问题**: 
- 核心目标（游戏产出）推迟到P8才实现
- P6-P7期间，用户看到的是"假忙碌"
- 演示效果差，无法向他人展示真实游戏

### 调整后的P6-P11规划

| 阶段 | 新内容 | 理由 |
|------|--------|------|
| **P6** | **实际游戏生成（核心目标）** | 🔥 确保核心功能优先实现 |
| **P7** | 人类介入机制（保持不变） | 顺序合理 |
| **P8-1** | **2D像素风办公室-必需功能** | 在有真实游戏产出后再可视化 |
| **P8-2** | **2D像素风办公室-可选功能** | 拆分为两阶段，P8-2可跳过 |
| **P9** | 美术集成（保持不变） | 顺序合理 |
| **P10** | **端到端联调测试（原P8）** | 此时所有功能已完整 |
| **P11** | **优化完善（原P10）** | 最后打磨 |

**核心优势**:
- ✅ P6完成后就能产出真实游戏
- ✅ P7有游戏可以演示和决策
- ✅ P8-1/P8-2做可视化时，可以展示真实的游戏产出
- ✅ 核心目标不丢失

---

## 🔄 详细调整内容

### P6: 从"前端可视化" → "实际游戏生成"

**新的P6任务**:
1. 增强程序员Agent的Prompt工程
   - 明确告知必须调用`file_tool.write()`
   - 提供代码模板和示例
   - 指定输出目录`projects/{项目名}/output/`

2. 实现实际代码写入
   - 程序员Agent生成代码后，**真正调用工具写文件**
   - 至少生成3个文件：`index.html`, `game.js`, `style.css`

3. 增强测试Agent的执行能力
   - 测试Agent**真正调用`code_runner.execute_html()`**
   - 检查游戏是否能成功运行

4. 实现Bug修复循环
   - 测试失败 → 报告Bug → 程序员修复 → 重测
   - 最多循环3次

**验收标准**: 用户能在浏览器中打开 `projects/snake_game/output/index.html` 玩到游戏！

**预计工作量**: 15-20轮对话（比原P6多）

---

### P7: 人类介入机制（保持不变）

**无变化**，继续使用原P7指引。

---

### P8: 从"端到端测试" → "2D像素风办公室"（拆分为两阶段）

#### P8-1: 必需功能

**任务**:
1. Pixi.js场景初始化
2. Agent精灵系统（使用Emoji或简单像素图）
3. 对话气泡系统（消息飞行动画）
4. 聊天记录窗口
5. 项目状态面板
6. WebSocket集成

**美术风格**: 像素风（Pixel Art）

**验收标准**: 能看到5个Agent在办公室中，消息实时显示

**预计工作量**: 10-12轮对话

#### P8-2: 可选增强功能

**任务**:
1. 真实像素风Agent动画（替代Emoji）
2. 办公室装饰（桌子、电脑、植物）
3. 游戏展示区（显示生成的游戏缩略图）
4. 交互增强（点击Agent查看详情）
5. 声音效果（可选）

**说明**: 如Token预算紧张，**可跳过P8-2**

**预计工作量**: 6-8轮对话

---

### P9: 美术集成（保持不变）

**无变化**，继续使用原P9指引。

---

### P10: 从"优化完善" → "端到端联调测试"

**新的P10任务**:
1. 完整工作流测试（从输入创意到产出游戏）
2. Agent通信测试
3. 人类介入测试
4. 前端实时更新测试（包括像素风办公室）
5. 文件系统测试
6. 错误恢复测试

**说明**: 原P8的内容移到这里，但此时包含了像素风办公室的测试

**预计工作量**: 10-15轮对话

---

### P11: 从无 → "优化完善"

**新的P11任务**:
1. 性能优化（LLM调用、消息处理、文件IO）
2. 体验优化（前端交互、错误提示、视觉效果）
3. 成本优化（Token消耗、图片生成、并发控制）
4. 文档完善（用户文档、开发者文档、部署指南）

**说明**: 原P10的内容移到这里

**预计工作量**: 6-10轮对话

---

## 📊 Token预算对比

### 原计划（P6-P10）

| 阶段 | Token预算 |
|------|-----------|
| P6 (前端可视化) | 6万 |
| P7 (人类介入) | 3.5万 |
| P8 (端到端测试) | 10万 |
| P9 (美术集成) | 3.5万 |
| P10 (优化完善) | 7万 |
| **总计** | **30万** |

### 调整后（P6-P11）

| 阶段 | Token预算 |
|------|-----------|
| P6 (实际游戏生成) | 8万 |
| P7 (人类介入) | 3.5万 |
| P8-1 (像素风办公室-必需) | 6万 |
| P8-2 (像素风办公室-可选) | 4万 |
| P9 (美术集成) | 3.5万 |
| P10 (端到端测试) | 10万 |
| P11 (优化完善) | 7万 |
| **总计** | **42万** |
| **跳过P8-2后** | **38万** |

**增加原因**:
- P6工作量增加（从简单可视化 → 复杂的代码生成）
- P8拆分为两个阶段

**建议**: 如Token预算紧张，可跳过P8-2

---

## ✅ 调整后的优势

### 1. 核心目标优先

**P6完成后立即可验收**:
- ✅ 能产出真实可玩的游戏
- ✅ 符合用户的核心目标
- ✅ 可以演示给他人

### 2. 风险降低

**避免"空壳"问题**:
- ✅ 不会出现"看起来在工作，但没有产出"的尴尬
- ✅ 每个阶段都有实际价值

### 3. 开发体验优化

**P7-P8的体验更好**:
- ✅ P7做决策时，有真实游戏可供决策
- ✅ P8-1做可视化时，可以展示真实的游戏产出
- ✅ P8-2的游戏展示区能显示实际生成的游戏

### 4. 灵活性提升

**P8-2可选**:
- ✅ 如Token预算不足，可以跳过P8-2
- ✅ 核心功能不受影响

---

## 📝 已完成的调整工作

### 1. 文档创建和修改

- [x] 备份原P6指引（2D可视化版本）
- [x] 重写P6指引为"实际游戏生成"
- [x] P7指引保持不变
- [x] 创建P8-1指引（2D像素风办公室-必需功能）
- [x] 创建P8-2指引（2D像素风办公室-可选功能）
- [x] P9指引保持不变
- [x] 创建P10指引（端到端联调测试，原P8内容）
- [x] 创建P11指引（优化完善，原P10内容）

### 2. 相关文档更新

- [x] 更新`docs/文档索引.md`（v1.7 → v2.0）
  - 阶段指引列表更新为P1-P11
  - 标注状态（✅ 已完成 / ⏳ 待开发）
  - 特别标注P6为"核心目标"

- [x] 更新`docs/开发流程总控.md`
  - 标题更新为"P1-P11阶段"
  - 各阶段快速参考表格更新
  - Token预算重新计算

- [x] 创建本报告（`docs/P6-P11阶段方案调整报告.md`）

---

## 🚀 后续执行建议

### 立即开始P6

**启动命令**:
```
请阅读 docs/stage_guides/P6_指引.md，并开始开发P6阶段
```

**重要提醒**:
- 🔥 P6是核心目标阶段，必须确保游戏真正产出
- 验收标准：用户能在浏览器中玩到游戏
- 如遇到困难，优先聚焦于最简单的游戏（如计数器）

### P8-2的决策点

**在P8-1完成后，评估是否继续P8-2**:
- ✅ Token预算充裕 → 继续P8-2（像素风增强）
- ⏸️ Token预算紧张 → 跳过P8-2，直接进入P9
- ⏸️ 核心功能更重要 → 跳过P8-2，专注优化

---

## 💡 用户决策记录

**用户确认的方案**:
1. ✅ 采用方案A（先做游戏产出，再做可视化）
2. ✅ 2D办公室放到P8
3. ✅ 将办公室分为P8-1（必需）和P8-2（可选）两个阶段
4. ✅ P8美术风格定为像素风
5. ✅ 重新修改P6-P11的指引文档

**调整依据**:
- 用户的核心目标：**产出可玩的游戏**
- 用户的担忧：怕核心目标丢失
- 用户的期望：既要有真实游戏，也要有2D办公室可视化

---

## 📖 相关文档

- `docs/stage_guides/P6_指引.md` - 实际游戏生成（新）
- `docs/stage_guides/P6_指引_2D可视化备份.md` - 原前端可视化内容（备份）
- `docs/stage_guides/P8-1_指引.md` - 2D像素风办公室-必需（新）
- `docs/stage_guides/P8-2_指引.md` - 2D像素风办公室-可选（新）
- `docs/stage_guides/P10_指引.md` - 端到端联调测试（新）
- `docs/stage_guides/P11_指引.md` - 优化完善（新）
- `docs/文档索引.md` - v2.0（已更新）
- `docs/开发流程总控.md` - （已更新）

---

**报告版本**: v1.0  
**创建日期**: 2026-02-12  
**维护者**: Cursor AI  
**状态**: ✅ 已完成  
**下一步**: 开始执行P6阶段开发
