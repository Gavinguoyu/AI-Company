# AIæ¸¸æˆå…¬å¸ - å¼€å‘è€…æ–‡æ¡£

> é¢å‘å¼€å‘è€…å’ŒæŠ€æœ¯äººå‘˜çš„è¯¦ç»†æ–‡æ¡£

---

## ğŸ“ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯ (Frontend)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åŠå…¬å®¤  â”‚  â”‚ Agenté¢æ¿ â”‚  â”‚ è€æ¿å¯¹è¯ â”‚  â”‚ WebSocketå®¢æˆ·ç«¯â”‚  â”‚
â”‚  â”‚ åœºæ™¯    â”‚  â”‚           â”‚  â”‚          â”‚  â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ WebSocket / HTTP
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åç«¯ (Backend)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ FastAPI     â”‚  â”‚ WebSocket    â”‚  â”‚ æ¶ˆæ¯æ€»çº¿           â”‚   â”‚
â”‚  â”‚ HTTP Routes â”‚  â”‚ Handler      â”‚  â”‚ MessageBus         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Agent Manager                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ PM â”‚ â”‚Plannerâ”‚ â”‚Programmerâ”‚ â”‚Artistâ”‚ â”‚Tester â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ LLM Client  â”‚  â”‚ Context Cacheâ”‚  â”‚ Tool Registry      â”‚   â”‚
â”‚  â”‚ (Gemini)    â”‚  â”‚ (P11æ–°å¢)    â”‚  â”‚ (File/Code/etc.)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é¡¹ç›®æ–‡ä»¶ (projects/)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ shared_knowledge/â”‚  â”‚    output/      â”‚                   â”‚
â”‚  â”‚ - GDD/TDD        â”‚  â”‚ - index.html    â”‚                   â”‚
â”‚  â”‚ - APIæ³¨å†Œè¡¨      â”‚  â”‚ - game.js       â”‚                   â”‚
â”‚  â”‚ - å†³ç­–æ—¥å¿—       â”‚  â”‚ - assets/       â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ ç¯å¢ƒé…ç½®

### å¿…è¦æ¡ä»¶
- Python â‰¥ 3.11
- pip åŒ…ç®¡ç†å™¨
- ç½‘ç»œè¿æ¥ï¼ˆè°ƒç”¨Gemini APIï¼‰

### å®‰è£…æ­¥éª¤

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repo-url>
cd AI-Company

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
.\venv\Scripts\activate   # Windows

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ GOOGLE_API_KEY
```

### ç¯å¢ƒå˜é‡è¯´æ˜

```bash
# .env æ–‡ä»¶å†…å®¹
GOOGLE_API_KEY=your_gemini_api_key_here
LOG_LEVEL=INFO
LOG_TO_FILE=true
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
AI-Company/
â”œâ”€â”€ backend/                 # Pythonåç«¯
â”‚   â”œâ”€â”€ main.py              # FastAPIå…¥å£
â”‚   â”œâ”€â”€ config.py            # å…¨å±€é…ç½®
â”‚   â”œâ”€â”€ engine/              # Agentå¼•æ“æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ agent.py         # AgentåŸºç±»
â”‚   â”‚   â”œâ”€â”€ llm_client.py    # LLMå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ message_bus.py   # æ¶ˆæ¯æ€»çº¿
â”‚   â”‚   â”œâ”€â”€ context_manager.py # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”‚   â””â”€â”€ context_cache.py # P11: Context Caching
â”‚   â”œâ”€â”€ agents/              # å…·ä½“Agentå®ç°
â”‚   â”‚   â”œâ”€â”€ pm_agent.py
â”‚   â”‚   â”œâ”€â”€ planner_agent.py
â”‚   â”‚   â”œâ”€â”€ programmer_agent.py
â”‚   â”‚   â”œâ”€â”€ artist_agent.py
â”‚   â”‚   â””â”€â”€ tester_agent.py
â”‚   â”œâ”€â”€ tools/               # Agentå·¥å…·
â”‚   â”‚   â”œâ”€â”€ file_tool.py
â”‚   â”‚   â”œâ”€â”€ code_runner.py
â”‚   â”‚   â”œâ”€â”€ code_search_tool.py
â”‚   â”‚   â”œâ”€â”€ image_gen_tool.py
â”‚   â”‚   â””â”€â”€ tool_registry.py
â”‚   â”œâ”€â”€ workflows/           # å·¥ä½œæµ
â”‚   â”‚   â””â”€â”€ game_dev_workflow.py
â”‚   â”œâ”€â”€ api/                 # Webæ¥å£
â”‚   â”‚   â”œâ”€â”€ http_routes.py
â”‚   â”‚   â””â”€â”€ websocket_handler.py
â”‚   â””â”€â”€ prompts/             # Promptæ¨¡æ¿
â”‚       â””â”€â”€ code_generation_template.py
â”œâ”€â”€ frontend/                # å‰ç«¯ç•Œé¢
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ app.js           # ä¸»åº”ç”¨
â”‚       â”œâ”€â”€ websocket.js     # WebSocketå®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ office_scene.js  # åŠå…¬å®¤åœºæ™¯
â”‚       â””â”€â”€ ...
â”œâ”€â”€ projects/                # ç”Ÿæˆçš„æ¸¸æˆé¡¹ç›®
â”œâ”€â”€ docs/                    # æ–‡æ¡£
â””â”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
```

---

## ğŸ”Œ API å‚è€ƒ

### HTTP API

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/health` | GET | å¥åº·æ£€æŸ¥ |
| `/api/project/start` | POST | åˆ›å»ºæ–°é¡¹ç›® |
| `/api/project/{id}/status` | GET | æŸ¥è¯¢é¡¹ç›®çŠ¶æ€ |
| `/api/projects` | GET | è·å–é¡¹ç›®åˆ—è¡¨ |
| `/api/boss/decision` | POST | æäº¤è€æ¿å†³ç­– |

### WebSocket äº‹ä»¶

**å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨:**
| äº‹ä»¶ç±»å‹ | æè¿° |
|----------|------|
| `subscribe_project` | è®¢é˜…é¡¹ç›®æ›´æ–° |
| `boss_decision_response` | æäº¤å†³ç­–å“åº” |

**æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯:**
| äº‹ä»¶ç±»å‹ | æè¿° |
|----------|------|
| `agent_message` | Agentæ¶ˆæ¯ |
| `agent_status` | AgentçŠ¶æ€å˜åŒ– |
| `phase_change` | é˜¶æ®µå˜åŒ– |
| `boss_decision` | è¯·æ±‚è€æ¿å†³ç­– |
| `file_update` | æ–‡ä»¶æ›´æ–° |
| `error_alert` | é”™è¯¯è­¦æŠ¥ |

---

## ğŸ› ï¸ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°Agent

1. åœ¨ `backend/agents/` åˆ›å»ºæ–°Agentæ–‡ä»¶ï¼š

```python
# backend/agents/my_agent.py
from engine.agent import Agent

class MyAgent(Agent):
    def __init__(self):
        super().__init__(
            agent_id="my_agent",
            role="è‡ªå®šä¹‰Agent",
            system_prompt="ä½ çš„è§’è‰²æè¿°...",
            tools=["file"]  # å¯ç”¨çš„å·¥å…·
        )
```

2. åœ¨ `workflows/game_dev_workflow.py` ä¸­æ³¨å†Œï¼š

```python
from agents.my_agent import MyAgent

# åœ¨ _create_agents æ–¹æ³•ä¸­æ·»åŠ 
self.agents["my_agent"] = MyAgent()
self.agent_manager.register_agent(self.agents["my_agent"])
```

### æ·»åŠ æ–°å·¥å…·

1. åœ¨ `backend/tools/` åˆ›å»ºå·¥å…·æ–‡ä»¶ï¼š

```python
# backend/tools/my_tool.py
class MyTool:
    async def do_something(self, param: str) -> dict:
        """å·¥å…·æ–¹æ³•"""
        return {"result": "done"}
```

2. åœ¨ `tools/tool_registry.py` æˆ–å·¥ä½œæµä¸­æ³¨å†Œï¼š

```python
from tools.my_tool import MyTool
registry.register_tool("my_tool", MyTool())
```

### è‡ªå®šä¹‰Prompt

ç¼–è¾‘ `backend/prompts/code_generation_template.py`ï¼š

```python
def get_custom_prompt(project_name: str) -> str:
    return f"""ä½ çš„è‡ªå®šä¹‰æç¤ºè¯...
    é¡¹ç›®: {project_name}
    """
```

---

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cd backend
python -m pytest ../tests/

# è¿è¡Œç‰¹å®šæµ‹è¯•
python -m pytest ../tests/test_p10_end_to_end.py -v
```

### æµ‹è¯•æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | æè¿° |
|------|------|
| `test_p10_end_to_end.py` | ç«¯åˆ°ç«¯æµ‹è¯• |
| `test_p7_decision.py` | å†³ç­–æœºåˆ¶æµ‹è¯• |
| `test_p3_tools.py` | å·¥å…·ç³»ç»Ÿæµ‹è¯• |
| `run_regression.py` | å›å½’æµ‹è¯• |

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ– (P11)

### Context Caching

P11å¼•å…¥äº†Gemini Context Cachingæ¥å‡å°‘Tokenæ¶ˆè€—ï¼š

```python
from engine.context_cache import get_cache_manager

cache = get_cache_manager()

# ç¼“å­˜æ–‡æ¡£
await cache.cache_content(gdd_content, "gdd_project")

# åç»­è¯·æ±‚ä½¿ç”¨ç¼“å­˜
response = await cache.generate_with_cache(
    cache_name=cache_name,
    new_prompt="æ ¹æ®GDDç¼–å†™ä»£ç "
)
```

### ç²¾ç®€ç‰ˆPrompt

ä½¿ç”¨ç²¾ç®€ç‰ˆPromptå‡å°‘Tokenï¼š

```python
from prompts.code_generation_template import get_compact_programmer_prompt

# åŸç‰ˆçº¦2000å­—ç¬¦ï¼Œç²¾ç®€ç‰ˆçº¦500å­—ç¬¦
prompt = get_compact_programmer_prompt("my_game")
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é”™è¯¯

1. **ImportError: No module named 'xxx'**
   - è§£å†³ï¼š`pip install xxx` æˆ–æ£€æŸ¥Pythonè·¯å¾„

2. **WebSocketè¿æ¥å¤±è´¥**
   - æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   - æ£€æŸ¥ç«¯å£8000æ˜¯å¦è¢«å ç”¨

3. **LLM APIè°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥API Keyæ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - æ£€æŸ¥APIé…é¢

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f logs/latest.log

# æŸ¥çœ‹ç‰¹å®šæ¨¡å—æ—¥å¿—
cat logs/llm_client.gemini-2.0-flash.2026-02-13.log
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç”¨æˆ·æŒ‡å—](user_guide.md) - é¢å‘æ™®é€šç”¨æˆ·
- [å¹³å°å®ªæ³•](platform_constitution.md) - æ¶æ„å’Œå®ç°è®°å½•
- [P11æŒ‡å¼•](stage_guides/P11_æŒ‡å¼•.md) - P11é˜¶æ®µå¼€å‘æŒ‡å¼•

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0 | æ›´æ–°æ—¶é—´: 2026-02-13*
