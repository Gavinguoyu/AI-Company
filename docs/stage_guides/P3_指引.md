# P3 é˜¶æ®µå¼€å‘æŒ‡å¼• - å·¥å…·ç³»ç»Ÿ

> **é˜¶æ®µåç§°**: P3 - å·¥å…·ç³»ç»Ÿ  
> **é¢„è®¡å¤æ‚åº¦**: ä¸­  
> **æ–‡æ¡£çº§åˆ«**: å·²å®Œæˆï¼ˆå‚è€ƒç”¨ï¼‰  
> **ä½¿ç”¨è¯´æ˜**: æœ¬æŒ‡å¼•ä¸ºå·²å®Œæˆé˜¶æ®µçš„ç²¾ç®€ç‰ˆï¼Œä¾›æŸ¥é˜…å’Œå‚è€ƒ

---

## ğŸ¯ é˜¶æ®µç›®æ ‡

ä¸ºAgentæä¾›æ“ä½œçœŸå®ä¸–ç•Œçš„èƒ½åŠ›ï¼š
1. **æ–‡ä»¶å·¥å…·** - å®‰å…¨çš„æ–‡ä»¶è¯»å†™æ“ä½œ
2. **ä»£ç æ‰§è¡Œå·¥å…·** - åœ¨éš”ç¦»ç¯å¢ƒä¸­æ‰§è¡ŒJavaScript/HTML
3. **ä»£ç æœç´¢å·¥å…·** - æœç´¢ç°æœ‰ä»£ç ä¸­çš„å‡½æ•°å’Œç±»å®šä¹‰
4. **å·¥å…·æ³¨å†Œæœºåˆ¶** - å…¨å±€å·¥å…·ç®¡ç†å’Œæƒé™æ§åˆ¶

---

## ğŸ“‹ æ ¸å¿ƒä»»åŠ¡æ¸…å•

### å·²å®Œæˆçš„åŠŸèƒ½

- [x] **æ–‡ä»¶å·¥å…·** (`backend/tools/file_tool.py`)
  - å¼‚æ­¥æ–‡ä»¶è¯»å–/å†™å…¥/è¿½åŠ 
  - æ–‡ä»¶å­˜åœ¨æ£€æŸ¥
  - åˆ—å‡ºç›®å½•å†…å®¹
  - åˆ é™¤æ–‡ä»¶
  - è·¯å¾„å®‰å…¨æ£€æŸ¥ï¼ˆé˜²æ­¢è®¿é—®å·¥ä½œç©ºé—´å¤–ï¼‰

- [x] **ä»£ç æ‰§è¡Œå·¥å…·** (`backend/tools/code_runner.py`)
  - æ‰§è¡ŒJavaScriptä»£ç 
  - æ‰§è¡ŒHTMLæ¸¸æˆï¼ˆåˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼‰
  - è¯­æ³•æ£€æŸ¥
  - è¶…æ—¶æ§åˆ¶ï¼ˆ30ç§’ï¼‰
  - ä¸´æ—¶ç›®å½•éš”ç¦»

- [x] **ä»£ç æœç´¢å·¥å…·** (`backend/tools/code_search_tool.py`)
  - æœç´¢å‡½æ•°å®šä¹‰
  - æœç´¢ç±»å®šä¹‰
  - æœç´¢å˜é‡å®šä¹‰
  - æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
  - è·å–APIæ³¨å†Œè¡¨
  - é€’å½’æœç´¢å­ç›®å½•

- [x] **å·¥å…·æ³¨å†Œæœºåˆ¶** (`backend/tools/tool_registry.py`)
  - å•ä¾‹å·¥å…·æ³¨å†Œè¡¨
  - Agentå·¥å…·åŒ…ï¼ˆæƒé™æ§åˆ¶ï¼‰
  - è‡ªåŠ¨æ–¹æ³•æ£€æµ‹
  - Promptç”Ÿæˆï¼ˆä¾›LLMç†è§£ï¼‰

- [x] **Agenté›†æˆ** (`backend/engine/agent.py` æ›´æ–°)
  - Agentå¯ä»¥å£°æ˜éœ€è¦çš„å·¥å…·
  - Agentå¯ä»¥è°ƒç”¨å·¥å…·
  - å·¥å…·è°ƒç”¨æ—¥å¿—è®°å½•

---

## ğŸ”— æ ¸å¿ƒæ¥å£

### FileTool
```python
class FileTool:
    async def read(file_path: str) -> str
    async def write(file_path: str, content: str) -> bool
    async def append(file_path: str, content: str) -> bool
    async def exists(path: str) -> bool
    async def list_directory(dir_path: str) -> List[str]
    async def delete(file_path: str) -> bool
```

### CodeRunner
```python
class CodeRunner:
    async def execute_js(code: str, timeout: int = 30) -> Dict
    async def execute_html_game(html_code: str) -> Dict
    def check_syntax(code: str, language: str) -> Dict
```

### CodeSearchTool
```python
class CodeSearchTool:
    async def search_function(function_name: str, directory: str) -> List[Dict]
    async def search_class(class_name: str, directory: str) -> List[Dict]
    async def check_function_exists(function_name: str, directory: str) -> bool
    async def get_api_registry(registry_path: str) -> Dict
```

### ToolRegistryï¼ˆå•ä¾‹ï¼‰
```python
class ToolRegistry:
    def register_tool(name: str, tool_instance: Any) -> None
    def get_tool(name: str) -> Optional[Any]
    async def call_tool(tool_name: str, method_name: str, *args, **kwargs) -> Any
    def list_tools() -> List[Dict]
```

### AgentToolkit
```python
class AgentToolkit:
    def __init__(agent_id: str)
    def enable_tool(tool_name: str) -> bool
    async def call(tool_name: str, method_name: str, *args, **kwargs) -> Any
    def get_available_tools() -> List[Dict]
    def get_tool_info_for_prompt() -> str
```

---

## âœ… éªŒè¯æ ‡å‡†

### åŠŸèƒ½éªŒè¯
- [x] æ–‡ä»¶å·¥å…·èƒ½è¯»å†™æ–‡ä»¶
- [x] ä»£ç æ‰§è¡Œå·¥å…·èƒ½è¿è¡ŒJSä»£ç 
- [x] ä»£ç æœç´¢å·¥å…·èƒ½æ‰¾åˆ°å‡½æ•°å®šä¹‰
- [x] Agentèƒ½æˆåŠŸè°ƒç”¨å·¥å…·
- [x] æƒé™æ§åˆ¶æ­£å¸¸å·¥ä½œ

### æµ‹è¯•ç»“æœ
- âœ… 6/6æµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… å·¥å…·é›†æˆæ­£å¸¸
- âœ… æƒé™éš”ç¦»æœ‰æ•ˆ

---

## ğŸ› ï¸ ä½¿ç”¨çš„Skills

- `python-design-patterns` - å·¥å…·æ³¨å†Œæœºåˆ¶ï¼ˆå·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ï¼‰
- `async-python-patterns` - å¼‚æ­¥æ–‡ä»¶æ“ä½œ
- `python-testing-patterns` - å·¥å…·åŠŸèƒ½æµ‹è¯•
- `logging-best-practices` - å·¥å…·æ‰§è¡Œæ—¥å¿—

---

## ğŸ“ å…³é”®æŠ€æœ¯ç‚¹

### 1. å·¥å…·æ³¨å†Œå’Œè°ƒç”¨
```python
# æ³¨å†Œå·¥å…·
registry = ToolRegistry()
registry.register_tool("file", FileTool())
registry.register_tool("code_runner", CodeRunner())

# Agentä½¿ç”¨å·¥å…·
agent = Agent(agent_id="programmer", tools=["file", "code_search"])
result = await agent.call_tool("file", "write", "game.js", code)
```

### 2. è·¯å¾„å®‰å…¨æ£€æŸ¥
```python
def _check_path_safety(self, path: str) -> bool:
    """ç¡®ä¿è·¯å¾„åœ¨å·¥ä½œç©ºé—´å†…"""
    abs_path = Path(path).resolve()
    return abs_path.is_relative_to(self.workspace_root)
```

### 3. ä¸´æ—¶ç›®å½•éš”ç¦»
```python
async def execute_js(self, code: str):
    # åœ¨ä¸´æ—¶ç›®å½•æ‰§è¡Œï¼Œé¿å…æ±¡æŸ“é¡¹ç›®
    with tempfile.TemporaryDirectory() as temp_dir:
        temp_file = Path(temp_dir) / "temp.js"
        # æ‰§è¡Œä»£ç ...
```

---

## ğŸ“ å·²ç”Ÿæˆçš„æ–‡æ¡£

- `docs/P2é˜¶æ®µå®ŒæˆæŠ¥å‘Š.md` (478è¡Œ) - è¯¦ç»†å®ç°æŠ¥å‘Š

---

## ğŸš€ ä¸‹ä¸€é˜¶æ®µ

**P3é˜¶æ®µ**: å·¥å…·ç³»ç»Ÿï¼ˆå½“å‰é˜¶æ®µï¼‰

**P2ä¸ºP3å‡†å¤‡çš„**:
- æ¶ˆæ¯æ€»çº¿å¯ä»¥ä¼ é€’å·¥å…·è°ƒç”¨ç»“æœ
- AgentåŸºç±»å·²é¢„ç•™å·¥å…·æ‰©å±•æ¥å£

---

**æŒ‡å¼•ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-11  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**å®é™…å·¥ä½œé‡**: åŒ…å«å‰ç½®ä»»åŠ¡çº¦15è½®å¯¹è¯
