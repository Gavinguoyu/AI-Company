# P8-2 阶段开发指引 - 2D像素风办公室（可选增强）

> **阶段名称**: P8-2 - 2D像素风办公室可视化（第2阶段）  
> **预计复杂度**: 中  
> **文档级别**: Level 1 (只更新constitution，不生成独立报告)  
> **美术风格**: 像素风（Pixel Art）  
> **使用说明**: 在P8-1完成后，如果Token预算充裕，可实施本阶段增强功能

---

## 🎯 阶段目标

P8-1已实现基础的办公室可视化。P8-2将增强视觉效果和交互体验，让办公室更加生动有趣。

**核心目标**: 增强P8-1的基础功能，提升视觉吸引力和用户体验
1. **像素风Agent动画** - 用真实像素图替代Emoji，添加走动/工作动画
2. **办公室装饰** - 添加桌子、电脑、植物等装饰物
3. **游戏展示区** - 在办公室某个角落显示生成的游戏缩略图
4. **交互增强** - 点击Agent查看详情，拖拽视图等

**重要**: 如果Token预算紧张，可以跳过P8-2，直接进入P9。

---

## 📋 核心任务清单（P8-2可选功能）

### 增强功能1: 真实像素风Agent
- [ ] 寻找或生成16x16像素的Agent图像
  - 方案A: 使用免费像素素材库（itch.io, OpenGameArt）
  - 方案B: 使用在线像素编辑器手绘（Piskel）
  - 方案C: 等P9集成DALL-E后生成
- [ ] 替换Emoji为像素图
- [ ] 添加简单动画（2帧：站立/工作）

### 增强功能2: 办公室装饰
- [ ] 添加办公桌精灵（5个，每个Agent一个）
- [ ] 添加电脑精灵（在桌子上）
- [ ] 添加装饰物：
  - 植物盆栽
  - 书架/文件柜
  - 咖啡机（休息区）
  - 任务板（墙上）
- [ ] 优化背景：
  - 地板纹理
  - 墙壁分区
  - 灯光效果（可选）

### 增强功能3: Agent动画
- [ ] 走动动画（当Agent从A移动到B时）
- [ ] 工作动画（工作时的动作循环）
- [ ] 庆祝动画（任务完成时）
- [ ] 思考动画（头顶问号）

### 增强功能4: 游戏展示区
- [ ] 在办公室右下角添加"游戏展示区"
- [ ] 显示当前项目生成的游戏：
  - 游戏名称
  - 生成时间
  - 缩略图（iframe或截图）
  - 点击可打开完整游戏
- [ ] 支持显示多个历史游戏

### 增强功能5: 交互增强
- [ ] 点击Agent弹出详情面板：
  - Agent当前状态
  - 最近发送的消息
  - 统计信息（发送了多少消息）
- [ ] 拖拽视图（可以移动摄像机）
- [ ] 缩放功能（放大/缩小办公室）
- [ ] 鼠标悬停提示（显示Agent名字）

### 增强功能6: 声音效果（可选）
- [ ] 消息发送音效（叮咚声）
- [ ] 任务完成音效（成功音）
- [ ] 错误音效（警告音）
- [ ] 背景音乐（轻柔的办公室氛围音）
- [ ] 音效可开关

---

## 🔗 前置依赖

### P8-1已提供的基础
- Pixi.js场景框架
- Agent精灵系统（基于Emoji）
- 消息飞行动画
- 聊天记录窗口
- WebSocket集成

**P8-2只需扩展，不需重写**

---

## ✅ 验证标准

### 视觉增强验证
- [ ] 像素风格统一
- [ ] Agent动画流畅
- [ ] 办公室装饰合理
- [ ] 游戏展示区正常显示

### 交互增强验证
- [ ] 点击Agent能弹出详情
- [ ] 拖拽视图流畅
- [ ] 音效播放正常（如果实现）

### 性能验证
- [ ] 多动画同时播放不卡顿
- [ ] 内存使用合理

---

## 🛠️ 推荐使用的Skills

- `modern-javascript-patterns` - ES6+
- `web-design-guidelines` - UI/UX增强
- `javascript-testing-patterns` - 测试（可选）

---

## 📐 技术要点

### 关键技术点1: 像素风精灵图

```javascript
// 方案A: 使用图片URL
const texture = PIXI.Texture.from('assets/programmer_16x16.png');
const sprite = new PIXI.Sprite(texture);

// 方案B: 使用Sprite Sheet（推荐，多个角色在一张图）
const sheet = PIXI.BaseTexture.from('assets/agents_spritesheet.png');
const textures = {
    pm: new PIXI.Texture(sheet, new PIXI.Rectangle(0, 0, 16, 16)),
    planner: new PIXI.Texture(sheet, new PIXI.Rectangle(16, 0, 16, 16)),
    // ...
};
```

### 关键技术点2: 简单2帧动画

```javascript
class AgentSprite {
    constructor(agentId, x, y) {
        // ... existing code ...
        
        // 创建动画精灵
        const idleFrame = PIXI.Texture.from(`assets/${agentId}_idle.png`);
        const workFrame = PIXI.Texture.from(`assets/${agentId}_work.png`);
        
        this.animatedSprite = new PIXI.AnimatedSprite([idleFrame, workFrame]);
        this.animatedSprite.animationSpeed = 0.1;  // 慢速
        this.animatedSprite.play();
        
        this.container.addChild(this.animatedSprite);
    }
    
    updateStatus(status) {
        if (status === 'working') {
            this.animatedSprite.play();  // 播放动画
        } else {
            this.animatedSprite.gotoAndStop(0);  // 停在第1帧
        }
    }
}
```

### 关键技术点3: 办公室装饰

```javascript
class OfficeScene {
    createDecorations() {
        // 添加桌子（简单矩形）
        const desks = [
            { x: 100, y: 150, width: 80, height: 40 },
            { x: 500, y: 150, width: 80, height: 40 },
            // ...
        ];
        
        desks.forEach(desk => {
            const deskSprite = new PIXI.Graphics();
            deskSprite.beginFill(0x8B4513);  // 棕色
            deskSprite.drawRect(0, 0, desk.width, desk.height);
            deskSprite.endFill();
            deskSprite.position.set(desk.x, desk.y);
            this.officeContainer.addChild(deskSprite);
        });
        
        // 添加植物（简单绿色圆圈）
        const plant = new PIXI.Graphics();
        plant.beginFill(0x27ae60);  // 绿色
        plant.drawCircle(0, 0, 15);
        plant.endFill();
        plant.position.set(50, 500);
        this.officeContainer.addChild(plant);
    }
}
```

### 关键技术点4: 游戏展示区

```javascript
class GameShowcase {
    constructor(x, y) {
        this.container = new PIXI.Container();
        this.container.position.set(x, y);
        
        // 背景框
        const bg = new PIXI.Graphics();
        bg.beginFill(0x2c3e50);
        bg.drawRect(0, 0, 150, 150);
        bg.endFill();
        this.container.addChild(bg);
        
        // 标题
        const title = new PIXI.Text('生成的游戏', {
            fontSize: 12,
            fill: 0xffffff
        });
        title.position.set(10, 10);
        this.container.addChild(title);
        
        // 游戏缩略图（iframe或图片）
        this.thumbnail = null;
    }
    
    showGame(projectName) {
        // 显示游戏名称
        const gameText = new PIXI.Text(projectName, {
            fontSize: 10,
            fill: 0xecf0f1
        });
        gameText.position.set(10, 30);
        this.container.addChild(gameText);
        
        // 提示：点击打开游戏
        const hint = new PIXI.Text('点击打开', {
            fontSize: 8,
            fill: 0x3498db
        });
        hint.position.set(10, 130);
        this.container.addChild(hint);
        
        // 交互
        this.container.interactive = true;
        this.container.buttonMode = true;
        this.container.on('click', () => {
            window.open(`/projects/${projectName}/output/index.html`, '_blank');
        });
    }
}
```

### 关键技术点5: Agent详情面板

```javascript
class AgentDetailPanel {
    show(agentId, agentData) {
        // 创建半透明黑色背景
        const overlay = new PIXI.Graphics();
        overlay.beginFill(0x000000, 0.7);
        overlay.drawRect(0, 0, 800, 600);
        overlay.endFill();
        
        // 详情面板
        const panel = new PIXI.Container();
        panel.position.set(200, 150);
        
        const bg = new PIXI.Graphics();
        bg.beginFill(0xffffff);
        bg.drawRoundedRect(0, 0, 400, 300, 10);
        bg.endFill();
        panel.addChild(bg);
        
        // Agent信息
        const title = new PIXI.Text(`${agentId} 详情`, {
            fontSize: 20,
            fill: 0x2c3e50
        });
        title.position.set(20, 20);
        panel.addChild(title);
        
        const status = new PIXI.Text(`当前状态: ${agentData.status}`, {
            fontSize: 14,
            fill: 0x7f8c8d
        });
        status.position.set(20, 60);
        panel.addChild(status);
        
        // 关闭按钮
        const closeBtn = new PIXI.Text('关闭', {
            fontSize: 16,
            fill: 0xe74c3c
        });
        closeBtn.position.set(350, 20);
        closeBtn.interactive = true;
        closeBtn.buttonMode = true;
        closeBtn.on('click', () => {
            this.container.removeChild(overlay);
            this.container.removeChild(panel);
        });
        panel.addChild(closeBtn);
        
        this.container.addChild(overlay);
        this.container.addChild(panel);
    }
}
```

---

## 🧪 测试方案

### Step 1: 视觉测试
手动验证：
- 像素风格统一性
- 动画流畅度
- 装饰物位置合理

### Step 2: 交互测试
- 点击Agent是否弹出详情
- 游戏展示区是否能打开游戏
- 音效是否正常播放

---

## 📝 完成后的文档工作

### 1. 更新 platform_constitution.md
在P8-2章节简要记录：
- 增强的视觉效果
- 新增的交互功能
- 素材来源

### 2. 不生成独立报告
P8-2是可选功能，简化文档

---

## 🚀 下一阶段预告

**P9阶段将实现**: 美术集成（DALL-E 3）

**P8-2为P9准备**:
- 像素图生成需求（可用DALL-E）
- 游戏展示区可显示DALL-E生成的素材

---

## 💡 开发提示

### 时间分配建议
- 像素风精灵: 30%
- 办公室装饰: 25%
- Agent动画: 20%
- 游戏展示区: 15%
- 交互增强: 10%

### 实施优先级
1. 像素风Agent（最重要）
2. 办公室装饰
3. 游戏展示区
4. Agent动画
5. 交互增强
6. 音效（最后，可跳过）

### 常见问题FAQ

**Q: 像素图从哪里获取？**
A: 
1. 免费素材库：itch.io, OpenGameArt
2. 在线编辑器：Piskel, Aseprite
3. 等P9后用DALL-E生成

**Q: 如果P8-2工作量太大？**
A: 只实现像素风Agent，其他跳过。

**Q: 性能会不会受影响？**
A: Pixi.js性能很好，几十个精灵完全没问题。

---

**指引版本**: v1.0  
**最后更新**: 2026-02-11  
**预计工作量**: 6-8轮对话（可选）
