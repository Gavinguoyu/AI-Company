# 阶段完成报告模板

> **用途**: AI生成阶段完成报告时遵循的精简模板  
> **目标**: 保留核心价值，删除冗余内容，节省70% Token消耗

---

## 📋 报告级别分类

### Level 1: 极简记录（不生成独立报告）
**适用阶段**: P7人类介入、P9美术集成等简单阶段

**处理方式**: 只更新 `platform_constitution.md`，不生成独立报告文件

**记录内容**:
```markdown
## P{X}: {阶段名称}

> 状态: ✅ 已完成 (日期)

### 核心实现
- `ClassName` (`file_path.py`) - {职责}
  - `method1(params) -> return` - {功能}

### 测试验证
✅ 功能测试通过 ({X}/{X})
✅ 集成测试通过

### 下一阶段集成点
- 接口: `xxx()`
- 使用方式: {简要说明}
```

**Token消耗**: ~0（免费更新，AI已在上下文中）

---

### Level 2: 精简报告（推荐）
**适用阶段**: P5、P6、P10等正常复杂度阶段

**报告结构**: 5个核心章节，150-200行

**Token消耗**: ~1-1.5万（vs 原5万，节省70%）

---

### Level 3: 详细报告
**适用阶段**: P8联调测试等关键里程碑

**报告结构**: 完整章节，400-500行

**Token消耗**: ~3.5-5万

---

## 📝 Level 2 精简报告标准模板

```markdown
# P{X} 阶段完成报告

> **完成日期**: YYYY-MM-DD  
> **测试状态**: ✅ {X}/{X}通过（100%）  
> **文档级别**: Level 2

---

## ✅ 核心实现

### 1. {模块名1} (`file_path.py`)

**职责**: {简要描述模块职责，1句话}

**关键接口**:
```python
class ClassName:
    async def method1(param: Type) -> ReturnType
        # {功能描述}
    
    async def method2(param: Type) -> ReturnType
        # {功能描述}
```

**核心特性**:
- ✅ 特性1
- ✅ 特性2
- ✅ 特性3

---

### 2. {模块名2} (`file_path.py`)

{类似结构...}

---

## 🔗 集成要点（供下一阶段使用）

**P{X+1}需要知道的**:

### 可调用的接口
```python
# 使用示例
from backend.{module} import {ClassName}

obj = ClassName()
result = await obj.method(params)
```

### 重要约束
- 约束1: {描述}
- 约束2: {描述}

### 数据格式
```json
{
  "field1": "value",
  "field2": 123
}
```

---

## 🎯 设计决策

### 为什么选择XXX方案？

**决策**: {简要描述决策内容}

**理由**:
1. {理由1}
2. {理由2}
3. {理由3}

**替代方案**: {为什么不选择其他方案}

**影响**: {对后续阶段的影响}

---

### {其他重要决策}

{类似结构...}

---

## ✅ 测试验证

**测试脚本**: `test_p{X}.py`  
**通过率**: {X}/{X} (100%)

**测试覆盖**:
- ✅ 模块导入
- ✅ 对象初始化
- ✅ {核心功能1}
- ✅ {核心功能2}
- ✅ 集成测试
- ✅ 回归测试

**实际验证**:
- {验证点1}: ✅
- {验证点2}: ✅
- {验证点3}: ✅

---

## 📊 完成标志

- ✅ 代码实现完成
- ✅ 测试全部通过
- ✅ platform_constitution.md 已更新
- ✅ 集成要点已记录
- ✅ 下一阶段准备就绪

---

**报告版本**: v1.0  
**下一步**: 开始 P{X+1} - {下一阶段名称}
```

---

## ⚠️ 编写规则

### ✅ 应该包含的（核心价值）

1. **核心实现** - 必须
   - 实现的类和接口
   - 关键方法签名（不要完整代码）
   - 核心特性列表

2. **集成要点** - 必须
   - 下一阶段需要的接口
   - 使用示例
   - 重要约束

3. **设计决策** - 必须
   - 重要的架构选择
   - 决策理由
   - 对后续的影响

4. **测试验证** - 必须（但精简）
   - 测试通过率
   - 测试覆盖项
   - 不要详细的测试输出

5. **完成标志** - 必须
   - 简单的清单

---

### ❌ 不应该包含的（冗余内容）

1. ❌ **代码统计**
   - 行数、文件数等可用工具统计
   - 节省: 10-20行

2. ❌ **技术亮点**（单独章节）
   - 可合并到设计决策中
   - 节省: 40-60行

3. ❌ **详细测试输出**
   - 不要粘贴完整的测试日志
   - 只记录通过率和覆盖项
   - 节省: 50-100行

4. ❌ **经验总结**（单独章节）
   - 可在项目结束后统一总结
   - 节省: 30-50行

5. ❌ **修复的BUG**（如果一次性通过）
   - 开发顺利时无此内容
   - 节省: 20-40行

6. ❌ **完整代码示例**
   - 只用接口签名，不要完整实现
   - 代码块控制在5-10行内
   - 节省: 每个代码块200-400tokens

---

## 📐 格式规范

### 章节标题
使用emoji + 标题，保持一致：
```markdown
## ✅ 核心实现
## 🔗 集成要点
## 🎯 设计决策
## ✅ 测试验证
## 📊 完成标志
```

### 代码块
只展示接口签名，不要完整实现：

```python
# ✅ 好的示例（只有签名）
class ClassName:
    async def method(param: Type) -> ReturnType
        # {功能描述}
```

```python
# ❌ 坏的示例（完整实现）
class ClassName:
    async def method(self, param: Type) -> ReturnType:
        logger.info("...")
        result = await some_operation()
        if result:
            return process(result)
        else:
            raise Exception("...")
        # ... 20行代码
```

### 清单格式
使用简洁的列表：

```markdown
✅ 功能1
✅ 功能2
✅ 功能3
```

而非详细描述：
```markdown
❌ 功能1: 这个功能实现了XXX，通过调用YYY接口，
   首先进行ZZZ处理，然后...（冗长描述）
```

---

## 🎯 质量检查清单

生成报告后，AI应自我检查：

- [ ] 总行数在150-200行内（Level 2）
- [ ] 只包含5个核心章节
- [ ] 代码示例都是接口签名，无完整实现
- [ ] 测试部分只有通过率和覆盖项
- [ ] 删除了代码统计、技术亮点等冗余章节
- [ ] 集成要点清晰，下一阶段可直接使用
- [ ] 设计决策有理有据

---

## 💡 特殊情况处理

### 如果开发过程中遇到重大Bug
可临时添加"BUG修复"章节，但控制在20-30行内：

```markdown
## 🐛 重大问题修复

### Bug: {问题描述}
- **现象**: {简要描述}
- **原因**: {根本原因}
- **修复**: {解决方案}
```

### 如果有重要的性能优化
可在设计决策中添加一个小节：

```markdown
### 性能优化决策
- **优化点**: {描述}
- **效果**: {提升多少}
```

---

## 📊 Token消耗对比

| 报告类型 | 行数 | 章节数 | 代码示例 | Token消耗 |
|---------|------|--------|---------|----------|
| **原版报告** | 400-500 | 10个 | 完整代码 | 5万 |
| **精简报告** | 150-200 | 5个 | 接口签名 | 1.5万 |
| **节省比例** | 60% | 50% | 80% | **70%** ✨ |

---

**模板版本**: v1.0  
**适用阶段**: P6-P10（Level 2文档级别）  
**维护建议**: 根据实际使用反馈持续优化
